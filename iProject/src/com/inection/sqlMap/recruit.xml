<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="recruit">

	<resultMap type="recruitVO" id="recruitVO">
		<result property="content" column="content" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>

	<!-- 게시판 목록 조회-->
	<select id="getRecruitList" parameterType="recruitVO" resultMap="recruitVO">
		<!-- 오라클 쿼리 START
		SELECT Y.* FROM (  
			SELECT ROWNUM AS NUM, X.* FROM (	
				SELECT
					ROWNUM AS RNUM
					,SSEQ 
					,SUBJECT
					,CONTENT
					,REGDATE
				FROM dkdlsprtus.home_recruit
					ORDER BY RNUM DESC
				) X
			WHERE ROWNUM <![CDATA[<=]]> #{endRow}
		) Y WHERE NUM > #{startRow} -->
		<!-- 오라클 쿼리 END -->
		
		<!-- MYSQL 쿼리 START -->
		SELECT Y.* FROM (  
			SELECT @NUM:=@NUM+1 AS NUM, X.* FROM (
        		SELECT W.* FROM (
        			SELECT @RNUM:=@RNUM+1 AS RNUM, SSEQ, SUBJECT, CONTENT, REGDATE FROM dkdlsprtus.home_recruit, (SELECT @RNUM:=0) V  
        			<if test="searchType != null and searchType != ''">
						WHERE ${searchType} LIKE '%${searchString}%' 
					</if>
					ORDER BY SSEQ ASC
        		) W ORDER BY W.RNUM DESC
			) X, (SELECT @NUM:=0) U
			WHERE (SELECT @RN:=@RN+1 FROM (SELECT @RN:=0) P) <![CDATA[<=]]> #{endRow}
		) Y WHERE NUM > #{startRow}
		<!-- MYSQL 쿼리 END -->
	</select>
	
	<!-- 게시판 목록 카운트 -->
	<select id="getRecruitListCnt" parameterType="recruitVO" resultType="int">
		SELECT
			COUNT(*) CNT
		FROM dkdlsprtus.home_recruit
		<if test="searchType != null and searchType != ''">
			WHERE ${searchType} LIKE '%${searchString}%' 
		</if>
	</select>
	
	<!-- 게시판 상세 보기 리스트 -->
	<select id="getRecruitDetailList" parameterType="recruitVO" resultMap="recruitVO">
       		SELECT W.* FROM (
       			SELECT @RNUM:=@RNUM+1 AS NUM
       			,SSEQ
       			,SUBJECT
			FROM dkdlsprtus.home_recruit, (SELECT @RNUM:=0) V 
				<if test="searchType != null and searchType != ''">
					WHERE ${searchType} LIKE '%${searchString}%' 
				</if>
				ORDER BY SSEQ ASC
       		) W ORDER BY W.NUM DESC
	</select>

	<!-- 게시판 상세 보기 -->
	<select id="getRecruitDetail" parameterType="int" resultMap="recruitVO" >
		SELECT
			SSEQ 
			,SUBJECT
			,CONTENT
			,REGDATE
		FROM dkdlsprtus.home_recruit
			WHERE SSEQ = #{recruitNo}
	</select>
	
	<!-- 게시판 글쓰기 -->
	<insert id="getRecruitInput" parameterType="recruitVO">
		INSERT INTO dkdlsprtus.home_recruit(
			<!--  SSEQ --> 
			SUBJECT 
			,CONTENT
			,REGDATE
		)VALUES(
			<!-- S_home_recruit.NEXTVAL     mySql은 자동 증가기능이 있음 -->
			#{subject}
			,#{content}
			,NOW()    <!--  SYSDATE  -->
		)
	</insert>
	
	<!-- 게시판 수정 -->
	<update id="setRecruitUpdate" parameterType="recruitVO">
		UPDATE dkdlsprtus.home_recruit SET
			SUBJECT = #{subject}
			,CONTENT = #{content}
		WHERE SSEQ = #{sseq}
	</update>
	
	<!-- 게시판 삭제 -->
	<delete id="setRecruitDelete" parameterType="int">
		DELETE FROM dkdlsprtus.home_recruit WHERE SSEQ = #{recruitNo}
	</delete>
	
</mapper>
